//   _            _           _                        _        _                 
//  (_)          | |         | |                      | |      (_)                
//   _ _ __   ___| |_   _  __| | ___    ___ ___  _ __ | |_ __ _ _ _ __   ___ _ __ 
//  | | '_ \ / __| | | | |/ _` |/ _ \  / __/ _ \| '_ \| __/ _` | | '_ \ / _ \ '__|
//  | | | | | (__| | |_| | (_| |  __/ | (_| (_) | | | | || (_| | | | | |  __/ |   
//  |_|_| |_|\___|_|\__,_|\__,_|\___|  \___\___/|_| |_|\__\__,_|_|_| |_|\___|_|   
//
//      Simple, elegant and maintainable container queries in Sass
//                             v1.0.0
//
//           https://github.com/PaulLVG/include-container
//           https://paullvg.github.io/include-container/
//
//      Respectful adaptation of `include-media` by Eduardo Boucas
//      & Kitty Giraudel, adapted to support container queries.
//      Original repo: https://eduardoboucas.github.io/include-media/
//      Fork maintained by: PaulLVG (https://github.com/PaulLVG)
//
//      This project is licensed under the terms of the MIT license.

/// include-container library public configuration
/// @group include-container
/// @access public
/*!
 * include-container
 * A tiny Sass port of `include-media`, but for Container Queries.
 * - Familiar shorthand syntax (e.g. '>=md', '<lg', 'height >= 40ch')
 * - No media-query fallback (by design)
 * - Optionally guarded via @supports (container-type / container-name)
 *
 * @author  @PaulLVG
 * @link    Repo:   https://github.com/PaulLVG/include-container
 * @link    Docs:   https://paullvg.github.io/include-container/
 * @link    NPM:    https://www.npmjs.com/package/@paullvg/include-container
 * @license MIT
 *
 * @example scss - Basic usage (inline-size by default)
 *  @include container('>=md') {
 *    .card { display: grid; gap: 1rem; }
 *  }
 *
 * @example scss - Height query
 *  @include container('height >= 40ch') {
 *    .teaser { display: block; }
 *  }
 *
 * @example scss - With a named container
 *  @include container('>=lg', $name: 'layout') {
 *    .sidebar { position: sticky; top: 1rem; }
 *  }
 *
 * @example scss - Backwards-compatible alias
 *  @include include-container('>sm') { ... }
 *
 * Tip
 * ----
 * Make sure an ancestor sets a container context, for example:
 *  .section { container-type: inline-size; container-name: layout; }
 * Then target it with $name: 'layout' if you need that specificity.
 */

@charset "UTF-8";
@use "sass:math";
@use "sass:map";
@use "sass:list";
@use "sass:string";
@use "sass:meta";

// -----------------------------------------------------------------------------
// Default configuration
// -----------------------------------------------------------------------------

$ic-breakpoints: (
  'xxs': 320px,
  'xs':  480px,
  'sm':  640px,
  'md':  768px,
  'lg':  1024px,
  'xl':  1280px,
  'xxl': 1536px
) !default;

$ic-unit-intervals: (
  'px': 1,
  'em': 0.01,
  'rem': 0.1,
  'ch': 0.1,
  '':  0
) !default;

$ic-guard-supports: true !default;

// -----------------------------------------------------------------------------
// Internal helpers
// -----------------------------------------------------------------------------

@function ic-str-trim($string) {
  @if string.slice($string, 1, 1) == ' ' {
    @return ic-str-trim(string.slice($string, 2));
  } @else if string.slice($string, string.length($string), -1) == ' ' {
    @return ic-str-trim(string.slice($string, 1, -2));
  } @else {
    @return $string;
  }
}

@function ic-to-length($value, $unit) {
  $units: (
    'px': 1px,
    'cm': 1cm,
    'mm': 1mm,
    '%':  1%,
    'ch': 1ch,
    'pc': 1pc,
    'in': 1in,
    'em': 1em,
    'rem': 1rem,
    'pt': 1pt,
    'ex': 1ex,
    'vw': 1vw,
    'vh': 1vh,
    'vmin': 1vmin,
    'vmax': 1vmax,
  );
  @if not list.index(map.keys($units), $unit) {
    @error "include-container: invalid unit `#{$unit}`.";
  }
  @return $value * map.get($units, $unit);
}

@function ic-to-number($value) {
  @if meta.type-of($value) == 'number' {
    @return $value;
  } @else if meta.type-of($value) != 'string' {
    @error "include-container: value for `ic-to-number` should be number or string.";
  }

  $first: string.slice($value, 1, 1);
  $result: 0;
  $digits: 0;
  $minus: ($first == '-');
  $numbers: (
    '0':0,
    '1':1,
    '2':2,
    '3':3,
    '4':4,
    '5':5,
    '6':6,
    '7':7,
    '8':8,
    '9':9
  );

  @if ($first == '+' or $first == '-') {
    $value: string.slice($value, 2);
  }

  @for $i from 1 through string.length($value) {
    $c: string.slice($value, $i, $i);

    @if not (list.index(map.keys($numbers), $c) or $c == '.') {
      @return ic-to-length(if($minus, -$result, $result), string.slice($value, $i));
    }

    @if $c == '.' {
      $digits: 1;
    } @else if $digits == 0 {
      $result: $result * 10 + map.get($numbers, $c);
    } @else {
      $digits: $digits * 10;
      $result: $result + math.div(map.get($numbers, $c), $digits);
    }
  }

  @return if($minus, -$result, $result);
}

@function ic-slice($list, $start: 1, $end: list.length($list)) {
  @if list.length($list) < 1 or $start > $end {
    @return ();
  }
  $result: ();
  @for $i from $start through $end {
    $result: list.append($result, list.nth($list, $i), comma);
  }
  @return $result;
}

@function ic-get-operator($expr) {
  @each $op in ('>=','>','<=','<','≥','≤') {
    @if string.index($expr, $op) {
      @return $op;
    }
  }
  @error "include-container: no operator found in `#{$expr}`.";
}

@function ic-get-dimension($expr, $op) {
  $op-index: string.index($expr, $op);
  $raw: string.slice($expr, 0, $op-index - 1);
  $raw: ic-str-trim($raw);
  $dimension: 'width';

  @if string.length($raw) > 0 {
    $dimension: $raw;
  }
  @return $dimension;
}

@function ic-get-prefix($op) {
  @return if(list.index(('<','<=','≤'), $op), 'max', 'min');
}

@function ic-get-value($expr, $op) {
  $op-index: string.index($expr, $op);
  $value: string.slice($expr, $op-index + string.length($op));
  $trimmed: ic-str-trim($value);

  @if map.has-key($ic-breakpoints, $trimmed) {
    $value: map.get($ic-breakpoints, $trimmed);
  } @else {
    $value: ic-to-number($trimmed);
  }

  $interval: map.get($ic-unit-intervals, math.unit($value));
  @if not $interval { @error "include-container: unknown unit `#{math.unit($value)}`."; }

  @if $op == '>' {
    $value: $value + $interval;
  } @else if $op == '<' {
    $value: $value - $interval;
  }

  @return $value;
}

@function ic-parse($expr) {
  $op: ic-get-operator($expr);
  $dim: ic-get-dimension($expr, $op);
  $prefix: ic-get-prefix($op);
  $value: ic-get-value($expr, $op);

  @if $dim == '' or $dim == 'width' or $dim == 'inline' or $dim == 'inline-size' {
    $dim: 'width';
  } @else if $dim == 'height' or $dim == 'block' or $dim == 'block-size' {
    $dim: 'height';
  }

  @return '(#{$prefix}-#{$dim}: #{$value})';
}

// -----------------------------------------------------------------------------
// Public mixins
// -----------------------------------------------------------------------------

@mixin container($conditions..., $name: null, $type: null, $supports: null) {
  $guard: if($supports == null, $ic-guard-supports, $supports);
  $feature: string.unquote(ic-parse(list.nth($conditions, 1)));
  $rule-name: if($name == null or $name == '', '', $name + ' ');

  @if $guard {
    @if $type == 'size' {
      @supports (container-type: size) {
        @container (#{$rule-name}#{$feature}) {
          $rest: ic-slice($conditions, 2);
          @if list.length($rest) > 0 {
            @include container($rest..., $name: $name, $type: $type, $supports: false) { @content; }
          } @else {
            @content;
          }
        }
      }
    } @else {
      @supports (container-type: inline-size) {
        @container (#{$rule-name}#{$feature}) {
          $rest: ic-slice($conditions, 2);
          @if list.length($rest) > 0 {
            @include container($rest..., $name: $name, $type: $type, $supports: false) { @content; }
          } @else {
            @content;
          }
        }
      }
    }
  } @else {
    @container (#{$rule-name}#{$feature}) {
      $rest: ic-slice($conditions, 2);
      @if list.length($rest) > 0 {
        @include container($rest..., $name: $name, $type: $type, $supports: false) { @content; }
      } @else {
        @content;
      }
    }
  }
}

@mixin include-container($conditions..., $name: null, $type: null, $supports: null) {
  @include container($conditions..., $name: $name, $type: $type, $supports: $supports) { @content; }
}